<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Conduct Bayesian Calibration on An EnergyPlus Model — BayesCalibJob • epluspar</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Conduct Bayesian Calibration on An EnergyPlus Model — BayesCalibJob" />
<meta property="og:description" content="bayes_job() takes an IDF and EPW as input and returns a BayesCalibJob,
which provides a prototype of conducting Bayesian calibration of EnergyPlus
model." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epluspar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ideas-lab-nus/epluspar">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Conduct Bayesian Calibration on An EnergyPlus Model</h1>
    <small class="dont-index">Source: <a href='https://github.com/ideas-lab-nus/epluspar/blob/master/R/bayesian.R'><code>R/bayesian.R</code></a></small>
    <div class="hidden name"><code>BayesCalibJob.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>bayes_job()</code> takes an IDF and EPW as input and returns a <code>BayesCalibJob</code>,
which provides a prototype of conducting Bayesian calibration of EnergyPlus
model.</p>
    </div>



    <h2 class="hasAnchor" id="usage"><a class="anchor" href="#usage"></a>Usage</h2>

    
<pre>bc &lt;- bayes_job(idf, epw)
bc$version()
bc$seed()
bc$weather()
bc$read_rdd(update = FALSE)
bc$read_mdd(update = FALSE)
bc$input(key_value = NULL, name = NULL, reporting_frequency = NULL, append = FALSE)
bc$output(key_value = NULL, name = NULL, reporting_frequency = NULL, append = FALSE)
bc$param(..., .names = NULL, .num_sim = 30L)
bc$apply_measure(measure, ..., .num_sim = 30L)
bc$samples()
bc$models()
bc$eplus_run(dir = NULL, run_period = NULL, wait = TRUE, force = FALSE,
             copy_external = FALSE, echo = wait)
bc$data_sim(resolution = NULL, exclude_ddy = TRUE, all = FALSE)
bc$data_field(output, new_input = NULL, all = FALSE)
bc$data_bc(data_field = NULL, data_sim = NULL)
bc$stan_run(file = NULL, data = NULL, iter = 2000L, chains = 4L, echo = TRUE,
            mc.cores = parallel::detectCores(), ...)
bc$stan_file(path = NULL)
bc$eplus_kill()
bc$eplus_status()
bc$eplus_output_dir(which = NULL)
bc$eplus_locate_output(which = NULL, suffix = ".err", strict = TRUE)
bc$eplus_errors(which = NULL, info = FALSE)
bc$eplus_report_data_dict(which = NULL)
bc$eplus_report_data(which = NULL, key_value = NULL, name = NULL,
                     year = NULL, tz = "UTC", all = FALSE, wide = FALSE,
                     period = NULL, month = NULL, day = NULL, hour = NULL, minute = NULL,
                     interval = NULL, simulation_days = NULL, day_type = NULL,
                     environment_name = NULL)
bc$eplus_tabular_data(which = NULL, report_name = NULL, report_for = NULL,
                      table_name = NULL, column_name = NULL, row_name = NULL)
bc$eplus_save(dir = NULL, separate = TRUE, copy_external = FALSE)
bc$print()
</pre>

    <h2 class="hasAnchor" id="create"><a class="anchor" href="#create"></a>Create</h2>

    
<pre>bc &lt;- bayes_job(idf, epw)
</pre>

<p>When calling <code>bayes_job()</code>, the objects of classes related in output variable
reporting will be deleted, in order to make sure all input and output
variable specifications can be achieved using <code>Output:Variable</code> and
<code>Output:Meter</code>. Classes to be deleted include:</p><ul>
<li><p><code>Output:Variable</code></p></li>
<li><p><code>Output:Meter</code></p></li>
<li><p><code>Output:Meter:MeterFileOnly</code></p></li>
<li><p><code>Output:Meter:Cumulative</code></p></li>
<li><p><code>Output:Meter:Cumulative:MeterFileOnly</code></p></li>
<li><p><code>Meter:Custom</code></p></li>
<li><p><code>Meter:CustomDecrement</code></p></li>
<li><p><code>Output:EnvironmentalImpactFactors</code></p></li>
</ul>

<p><strong>Arguments</strong></p><ul>
<li><p><code>idf</code>: Path to EnergyPlus IDF file or an <code>Idf</code> object.</p></li>
<li><p><code>epw</code>: Path to EnergyPlus EPW file or an <code>Epw</code> object.</p></li>
</ul>

    <h2 class="hasAnchor" id="get-seed-model-and-weather"><a class="anchor" href="#get-seed-model-and-weather"></a>Get Seed Model and Weather</h2>

    
<pre>param$version()
param$seed()
param$weather()
</pre>

<p><code>$version()</code> returns the version of input Idf object.</p>
<p><code>$seed()</code> returns the input Idf object.</p>
<p><code>$weather()</code> returns the input Epw object.</p>
    <h2 class="hasAnchor" id="get-rdd-amd-mdd-data-of-seed-model"><a class="anchor" href="#get-rdd-amd-mdd-data-of-seed-model"></a>Get RDD amd MDD Data of Seed Model</h2>

    
<pre>param$read_rdd(update = FALSE)
param$read_mdd(update = FALSE)
</pre>

<p><code>$read_rdd()</code> and <code>$read_mdd()</code> silently runs EnergyPlus using input seed
model with design-day-only mode to create <code>.rdd</code> and <code>.mdd</code> file and returns
the corresponding <a href='https://hongyuanjia.github.io/eplusr/reference/rdd.html'>RddFile</a> and
<a href='https://hongyuanjia.github.io/eplusr/reference/rdd.html'>MddFile</a> object, respectively. The <code>RddFile</code> and
<code>MddFile</code> object is stored internally and will be directly returned whenever
you call <code>$read_rdd()</code> and <code>$read_mdd()</code> again. You can force to run the
design-day-only simulation again to update the contents by setting <code>update</code>
to <code>TRUE</code>.</p>
<p><code>$read_rdd()</code> and <code>read_mdd()</code> is useful when adding input and output
parameters.</p>
<p><strong>Arguments</strong></p><ul>
<li><p><code>update</code>: Whether to run the design-day-only simulation and parse <code>.rdd</code>
and <code>.mdd</code> file again. Default: <code>FALSE</code>.</p></li>
</ul>

    <h2 class="hasAnchor" id="set-input-and-output-parameters"><a class="anchor" href="#set-input-and-output-parameters"></a>Set Input and Output Parameters</h2>

    
<pre>bc$input(key_value = NULL, name = NULL, reporting_frequency = NULL, append = FALSE)
bc$output(key_value = NULL, name = NULL, reporting_frequency = NULL, append = FALSE)
</pre>

<p><code>$input()</code> and <code>$output()</code> takes input and output parameter definitions in a
similar pattern as you set output variables in <code>Output:Variable</code> and
<code>Output:Meter</code> class and returns a <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>
containing the information of input and output parameters. For <code>$input()</code>,
only variables in RDD are allowed. For <code>$output()</code>, both variables in RDD and
MDD are allowd. The returned data.table has 5 columns:</p><ul>
<li><p><code>index</code>: Indices of input or output parameters.</p></li>
<li><p><code>class</code>: The class that parameters belong to. Will be either
<code>Output:Variable</code> or <code>Output:Meter</code>.</p></li>
<li><p><code>key_value</code>: Key value name for variables.</p></li>
<li><p><code>variable_name</code>: Variable names listed in RDD or MDD.</p></li>
<li><p><code>reporting_frequency</code>: Variable reporting frequency.</p></li>
</ul>

<p>If calling without any argument, the existing input and output parameters are
directly returned, e.g. <code>bc$input()</code> and <code>bc$output()</code>.</p>
<p>You can remove all existing input and output parameter by setting <code>append</code> to
<code>NULL</code>, e.g. <code>bc$input(append = NULL)</code> and <code>bc$output(append = NULL)</code>.</p>
<p><code>key_value</code> accepts 3 different formats:</p><ul>
<li><p>A character vector.</p></li>
<li><p>An <code>RddFile</code> or an <code>MddFile</code> object. They can be retrieved using
<code>$read_rdd()</code> and <code>$read_mdd()</code>. In this case, <code>name</code> argument will be
ignored, as its values are directly taken from variable names in input
<code>RddFile</code> and <code>MddFile</code> object. For example:</p><pre>bc$input(bc$read_rdd()[1:5])
bc$output(bc$read_mdd()[1:5])
</pre></li>
<li><p>A <code><a href='https://rdrr.io/r/base/data.frame.html'>data.frame()</a></code> with valid format for adding <code>Output:Variable</code> and
<code>Output:Meter</code> objects using <a href='https://hongyuanjia.github.io/eplusr/reference/Idf.html'>Idf$load()</a>. In this case, <code>name</code>
argument will be ignored. For example:</p></li>
</ul><pre>bc$input(eplusr::rdd_to_load(bc$read_rdd()[1:5]))
bc$output(eplusr::mdd_to_load(bc$read_mdd()[1:5]))
</pre>

<p><strong>Arguments</strong></p><ul>
<li><p><code>key_value</code>: Key value name for variables. If not specified, <code><a href='https://rdrr.io/r/base/Arithmetic.html'>"*"</a></code> are used
for all variables. <code>key_value</code> can also be an <code>RddFile</code>, <code>MddFile</code> or a
<code><a href='https://rdrr.io/r/base/data.frame.html'>data.frame()</a></code>. Please see description above.</p></li>
<li><p><code>name</code>: Variable names listed in RDD or MDD.</p></li>
<li><p><code>reporting_frequency</code>: Variable reporting frequency for <strong>all</strong> variables.
If <code>NULL</code>, <code>"Timestep"</code> are used for all variables. All possible
values: <code>"Detailed"</code>, <code>"Timestep"</code>, <code>"Hourly"</code>, <code>"Daily"</code>, <code>"Monthly"</code>,
<code>"RunPeriod"</code>, <code>"Environment"</code>, and <code>"Annual"</code>. Default: <code>NULL</code>.</p></li>
<li><p><code>append</code>: Whether to append input variables at the end of
existing ones. A special value <code>NULL</code> can be given to remove all existing
parameters. Default: <code>FALSE</code>.</p></li>
</ul>

    <h2 class="hasAnchor" id="set-parameters"><a class="anchor" href="#set-parameters"></a>Set Parameters</h2>

    
<pre>bc$param(..., .names = NULL, .num_sim = 30L)
bc$apply_measure(measure, ..., .num_sim = 30L)
bc$samples()
bc$models()
</pre>

<p>There are 2 ways to set calibration parameters in <code>BayesCalibJob</code> class,
i.e. <code>$param()</code> and <code>$apply_measure()</code>.</p>
<p><code>$param()</code> takes parameter definitions in list format, which is similar to
<code>$set()</code> in <a href='https://hongyuanjia.github.io/eplusr/reference/Idf.html'>eplusr::Idf</a> class except that each field is not assigned with a
single value, but a numeric vector of length 2, indicating the minimum and
maximum of the parameter. Every list in <code>$param()</code> should be named with a
valid object name. Object ID can also be used but have to be combined with
prevailing two periods <code>..</code>, e.g. <code>..10</code> indicates the object with ID <code>10</code>.</p>
<p>There is two special syntax in <code>$param()</code>:</p><ul>
<li><p><code>class := list(field = value)</code>: Note the use of <code>:=</code> instead of <code>=</code>. The
main difference is that, unlike <code>=</code>, the left hand side of <code>:=</code> should be a
valid class name in the seed model. It will treat the specified field of
all objects in specified class to as a single calibration parameter.</p></li>
<li><p><code>.(object, object) := list(field = value)</code>: Simimar like above, but note
the use of <code>.()</code> in the left hand side. You can put multiple object ID or
names in <code>.()</code>. It will treat the field of all specified objects to as a
single calibration parameter.</p></li>
</ul>

<p>For example, the code block below defines 4 calibration parameters:</p><ul>
<li><p>Field <code>Fan Total Efficiency</code> in object named <code>Supply Fan 1</code> in class
<code>Fan:VariableVolume</code> class, with minimum and maximum being 0.1 and 1.0,
respectively.</p></li>
<li><p>Field <code>Thickness</code> in all objects in class <code>Material</code>, with minimum and
maximum being 0.01 and 1.0, respectively.</p></li>
<li><p>Field <code>Conductivity</code> in all objects in class <code>Material</code>, with minimum and
maximum being 0.1 and 0.6, respectively.</p></li>
<li><p>Field <code>Watts per Zone Floor Area</code> in objects <code>Light1</code> and <code>Light2</code> in class
<code>Lights</code>, with minimum and maximum being 10 and 30, respectively.</p></li>
</ul><pre>bc$param(
    `Supply Fan 1` = list(Fan_Total_Efficiency = c(min = 0.1, max = 1.0)),
    Material := list(Thickness = c(0.01, 1), Conductivity = c(0.1, 0.6)),
   .("Light1", "Light2") := list(Watts_per_Zone_Floor_Area = c(10, 30))
)
</pre>

<p><strong>Arguments</strong></p><ul>
<li><p><code>...</code>: Lists of paramter definitions. Each list should be named with a valid
object name or a valid object ID denoted in style <code>..1</code>, <code>..2</code> and etc. For
specifying the fields for all objects in a class, the class name instead of
the object name should be used, and a special notation <code>:=</code> should be used
instead of <code>=</code>, e.g. <code>class := list(field = value)</code>. For grouping fields
from different objects in the same class, use <code>.()</code> in the left hand side
and put object ID or names inside., .e.g <code>.(object1, object2) := list(field = value)</code>.</p></li>
<li><p><code>.num_sim</code>: An positive integer specifying the number of simulations to run
for each combination of calibration parameter value. Default:
<code>30L</code>.</p></li>
<li><p><code>.names</code>: A character vector of the parameter names. If <code>NULL</code>,
the parameter will be named in format <code>t + number</code>. Default: <code>NULL</code>.</p></li>
</ul>

<p><code>$apply_measure()</code> works in a similar way as the <code>$apply_measure</code> in
<a href='https://hongyuanjia.github.io/eplusr/reference/ParametricJob.html'>eplusr::ParametricJob</a> class, with only exception that each argument
supplied in <code>...</code> should be a numeric vector of length 2, indicating the
minimum and maximum of the calibration parameter.
Basically <code>$apply_measure()</code> allows to apply a measure to an Idf.
A measure here is just a function that takes an Idf object and other
arguments as input, and returns a modified Idf object as output. The names
of function parameter will be used as the names of calibration parameter. For
example, the equivalent version of specifying parameters described above
using <code>$apply_measure()</code> can be:</p><pre>measure &lt;- function (idf, efficiency, thickness, conducitivy, lpd) {
    idf$set(
        `Supply Fan 1` = list(Fan_Total_Efficiency = efficiency),
        Material := list(Thickness = thickness, Conductivity = conducivity)
        .("Light1", "Light2") := list(Watts_per_Zone_Floor_Area = lpd)
    )

    idf
}

bc$apply_measure(measure,
    efficiency = c(min = 0.1, max = 1.0),
    thickness = c(0.01, 1), conductivity = c(0.1, 0.6),
    lpd = c(10, 30)
)
</pre>

<p><strong>Arguments</strong></p><ul>
<li><p><code>measure</code>: A function that takes an <code>Idf</code> and other arguments as input and
returns an <code>Idf</code> object as output.</p></li>
<li><p><code>...</code>: Arguments <strong>except first <code>Idf</code> argument</strong> that are passed to that
<code>measure</code>.</p></li>
<li><p><code>.num_sim</code>: An positive integer specifying the number of simulations to run
for each value of calibration parameter value. (NOT CORRECT). Default:
<code>30L</code>.</p></li>
</ul>

<p>All models created using <code>$param()</code> and <code>$apply_measure()</code> will be named in
the same pattern, i.e. <code>Case_ParameterName(ParamterValue)...</code>. Note that only
paramter names will be abbreviated using <code><a href='https://rdrr.io/r/base/abbreviate.html'>abbreviate()</a></code> with <code>minlength</code>
being <code>5L</code> and <code>use.classes</code> being <code>TRUE</code>. If samples contain duplications,
<code><a href='https://rdrr.io/r/base/make.unique.html'>make.unique()</a></code> will be called to make sure every model has a unique name.</p>
<p><code>$samples()</code> returns a <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a> which contains
the sampled value for each parameter using <a href='https://rdrr.io/pkg/lhs/man/randomLHS.html'>Random Latin Hypercube Sampling</a> method. The returned data.table has <code>1 + n</code>
columns, where <code>n</code> is the parameter number, and <code>1</code> indicates an extra column
named <code>case</code> giving the index of each sample. Note that if <code>$samples()</code> is
called before input and output parameters being set using <code>$input()</code> and
<code>$output()</code>, only the sampling will be performed and no parametric models
will be created. This is because information of input and output parameters
are needed in order to make sure that corresponding variables will be
reported during simulations. In this case, you can use <code>$models()</code> to create
those models.</p>
<p><code>$models()</code> returns a list of parametric <a href='https://hongyuanjia.github.io/eplusr/reference/Idf.html'>Idf</a> objects created
using calibration parameter values genereated using Random Latin Hypercube
Sampling. As stated above, parametric models can only be created after input,
output and calibration parameters have all be set using <code>$input()</code>,
<code>$output()</code> and <code>$param()</code> (or <code>$apply_measure()</code>), respectively.</p>
<p>All models will be named in the same pattern, i.e.
<code>Case_ParameterName(ParamterValue)...</code>. Note that paramter names will be
abbreviated using <code><a href='https://rdrr.io/r/base/abbreviate.html'>abbreviate()</a></code> with <code>minlength</code> being <code>5L</code> and
<code>use.classes</code> being <code>TRUE</code>.</p>
    <h2 class="hasAnchor" id="run-parametric-simulations"><a class="anchor" href="#run-parametric-simulations"></a>Run Parametric Simulations</h2>

    
<pre>bc$eplus_run(dir = NULL, run_period = NULL, wait = TRUE, force = FALSE,
             copy_external = FALSE, echo = wait)
</pre>

<p><code>$eplus_run()</code> runs all parametric models in parallel. Parameter <code>run_period</code>
can be given to insert a new <code>RunPeriod</code> object. In this case, all existing
<code>RunPeriod</code> objects in the seed model will be commented out.</p>
<p>Note that when <code>run_period</code> is given, value of field <code>Run Simulation for Weather File Run Periods</code> in <code>SimulationControl</code> class will be reset to <code>Yes</code>
to make sure input run period can take effect.</p>
<p><strong>Arguments</strong></p><ul>
<li><p><code>dir</code>: The parent output directory for specified simulations. Outputs of
each simulation are placed in a separate folder under the parent directory.
If <code>NULL</code>, directory of seed model will be used. Default: <code>NULL</code>.</p></li>
<li><p><code>run_period</code>: A list giving a new <code>RunPeriod</code> object definition. If not
<code>NULL</code>, only this new RunPeriod will take effect with all existing
RunPeriod objects in the seed model being commented out. If <code>NULL</code>,
existing run period in the seed model will be used. Default: <code>NULL</code>.</p></li>
<li><p><code>wait</code>: If <code>TRUE</code>, R will hang on and wait all EnergyPlus simulations
finish. If <code>FALSE</code>, all EnergyPlus simulations are run in the background.
Default: <code>TRUE</code>.</p></li>
<li><p><code>force</code>: Only applicable when the last simulation runs with <code>wait</code> equals
to <code>FALSE</code> and is still running. If <code>TRUE</code>, current running job is
forced to stop and a new one will start. Default: <code>FALSE</code>.</p></li>
<li><p><code>copy_external</code>: If <code>TRUE</code>, the external files that every <code>Idf</code> object
depends on will also be copied into the simulation output directory. The
values of file paths in the Idf will be changed automatically. Currently,
only <code>Schedule:File</code> class is supported.  This ensures that the output
directory will have all files needed for the model to run. Default is
<code>FALSE</code>.</p></li>
<li><p><code>echo</code>: Only applicable when <code>wait</code> is <code>TRUE</code>. Whether to print simulation
status. Default: the value of <code>wait</code>.</p></li>
</ul>

    <h2 class="hasAnchor" id="collect-simulation-data"><a class="anchor" href="#collect-simulation-data"></a>Collect Simulation Data</h2>

    
<pre>bc$data_sim(resolution = NULL, exclude_ddy = TRUE, all = FALSE)
</pre>

<p><code>$data_sim()</code> returns a list of 2 <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>
which contains the simulated data of input and output parameters. These data
will be stored internally and used during Bayesian calibration using Stan.</p>
<p>The <code>resolution</code> parameter can be used to specify the time resolution of
returned data. Note that input time resolution cannot be smaller than the
reporting frequency, otherwise an error will be issued.</p>
<p>The parameter is named in the same way as standard EnergyPlus csv output
file, i.e. <code>KeyValue:VariableName[Unit](Frequency)</code>.</p>
<p>By default, <code>$data_sim()</code> returns minimal columns, i.e. the <code>Date/Time</code>
column together with all input and output parameters are returned. You can
retrieve extra columns by setting <code>all</code> to <code>TRUE</code>. Those column include:</p><ul>
<li><p><code>case</code>: Integer type. Indices of parametric simulations.</p></li>
<li><p><code>environment_period_index</code>: Integer type. The indice of environment.</p></li>
<li><p><code>environment_name</code>: Character type. A text string identifying the
simulation environment.</p></li>
<li><p><code>simulation_days</code>: Integer type. Day of simulation.</p></li>
<li><p><code>datetime</code>: DateTime type. The date time of simulation result. Note that
the year valueas are automatically calculated to meets the start day of
week restriction for each simulation environment.</p></li>
<li><p><code>month</code>: Integer type. The month of reported date time.</p></li>
<li><p><code>day</code>: Integer type. The day of month of reported date time.</p></li>
<li><p><code>hour</code>: Integer type. The hour of reported date time.</p></li>
<li><p><code>minute</code>: Integer type. The minute of reported date time.</p></li>
<li><p><code>day_type</code>: Character type. The type of day, e.g. <code>Monday</code>, <code>Tuesday</code> and
etc. Note that <code>day_type</code> will always be <code>NA</code> if <code>resolution</code> is specified.</p></li>
</ul>

<p><strong>Arguments</strong></p><ul>
<li><p><code>resolution</code>: A character string specifying a time unit or a multiple of a
unit to change the time resolution of returned simulation data. Valid base
units are <code>min</code>, <code>hour</code>, <code>day</code>, <code>week</code>, <code>month</code>, and <code>year</code>.
Example: <code>10 mins</code>, <code>2 hours</code>, <code>1 day</code>. If <code>NULL</code>, the variable reporting
frequency is used. Default: <code>NULL</code>.</p></li>
<li><p><code>exclude_ddy</code>: Whether to exclude design day data. Default: <code>TRUE</code>.
Default: <code>FALSE</code>.</p></li>
<li><p><code>all</code>: If <code>TRUE</code>, extra columns are also included in the returned
<a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a> describing the simulation case and
datetime components. Default: <code>FALSE</code>.</p></li>
</ul>

    <h2 class="hasAnchor" id="specify-measured-data"><a class="anchor" href="#specify-measured-data"></a>Specify Measured Data</h2>

    
<pre>bc$data_field(output, new_input = NULL, all = FALSE)
</pre>

<p><code>$data_field()</code> takes a <code><a href='https://rdrr.io/r/base/data.frame.html'>data.frame()</a></code> of measured value of output
parameters and returns a list of <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>s
which contains the measured value of input and output parameters, and newly
measured value of input if applicable.</p>
<p>The specified <code>output</code> <code><a href='https://rdrr.io/r/base/data.frame.html'>data.frame()</a></code> is validated using criteria below:</p><ul>
<li><p>The column number should be the same as the number of output specified in
<code>$output()</code>.</p></li>
<li><p>The row number should be the same as the number of simulated values for
each case extracted using <code>$data_sim()</code>.</p></li>
</ul>

<p>For input parameters, the values of simulation data for the first case are
directly used as the measured values.</p>
<p>Parameter <code>new_input</code> can be used to give a <code><a href='https://rdrr.io/r/base/data.frame.html'>data.frame()</a></code> of newly measured
value of input parameters. The column number of input <code><a href='https://rdrr.io/r/base/data.frame.html'>data.frame()</a></code> should
be the same as the number of input parameters specified in <code>$input()</code>. If not
specified, the measured values of input parameters will be used for
predictions.</p>
<p>All the data will be stored internally and used during Bayesian calibration
using Stan.</p>
<p>Note that as <code>$data_field()</code> relies on the output of <code>$data_sim()</code> to
perform validation on the specified data, <code>$data_field()</code> cannot be called
before <code>$data_sim()</code> and internally stored data will be removed whenever
<code>$data_sim()</code> is called. This aims to make sure that simulated data and field
data can be matched whenever the calibration is performed.</p>
<p><strong>Arguments</strong></p><ul>
<li><p><code>output</code>: A <code><a href='https://rdrr.io/r/base/data.frame.html'>data.frame()</a></code> containing measured value of output parameters.</p></li>
<li><p><code>new_input</code>: A <code><a href='https://rdrr.io/r/base/data.frame.html'>data.frame()</a></code> containing newly measured value of input
parameters.</p></li>
<li><p><code>all</code>: If <code>TRUE</code>, extra columns are also included in the returned
<a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a> describing the simulation case and
datetime components. For details, please see <code>$data_sim()</code>. Default:
<code>FALSE</code>.</p></li>
</ul>

    <h2 class="hasAnchor" id="run-bayesian-calibration-using-stan"><a class="anchor" href="#run-bayesian-calibration-using-stan"></a>Run Bayesian Calibration Using Stan</h2>

    
<pre>bc$data_bc(data_field = NULL, data_sim = NULL)
bc$stan_run(file = NULL, data = NULL, iter = 2000L, chains = 4L, echo = TRUE,
            mc.cores = parallel::detectCores(), ...)
bc$stan_file(path = NULL)
</pre>

<p><code>$data_bc()</code> takes a list of field data and simulated data, and returns a
list that contains data input for Bayesican calibration using the Stan model
from Chong (2018):</p><ul>
<li><p><code>n</code>: Number of measured parameter observations.</p></li>
<li><p><code>n_pred</code>: Number of newly design points for predictions.</p></li>
<li><p><code>m</code>: Number of simulated observations.</p></li>
<li><p><code>p</code>: Number of input parameters.</p></li>
<li><p><code>q</code>: Number of calibration parameters.</p></li>
<li><p><code>yf</code>: Data of measured output after z-score standardization using data of
simulated output.</p></li>
<li><p><code>yc</code>: Data of simulated output after z-score standardization.</p></li>
<li><p><code>xf</code>: Data of measured input after min-max normalization.</p></li>
<li><p><code>xc</code>: Data of simulated input after min-max normalization.</p></li>
<li><p><code>x_pred</code>: Data of new design points for predictions after min-max
normalization.</p></li>
<li><p><code>tc</code>: Data of calibration parameters after min-max normalization.</p></li>
</ul>

<p>Input <code>data_field</code> and <code>data_sim</code> should have the same structure as the
output from <code>$data_field()</code> and <code>$data_sim()</code>. If <code>data_field</code> and
<code>data_sim</code> is not specified, the output from <code>$data_field()</code> and
<code>$data_sim()</code> will be used.</p>
<p><code>$stan_run()</code> runs Bayesian calibration using <a href='https://rdrr.io/pkg/rstan/man/stan.html'>Stan</a> and
returns a list of 2 elements:</p><ul>
<li><p><code>fit</code>: An object of S4 class <a href='https://rdrr.io/pkg/rstan/man/stanfit-class.html'>rstan::stanfit</a>.</p></li>
<li><p><code>y_pred</code>: A <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a> with predicted output
values.</p></li>
</ul>

<p><code>$stan_file()</code> saves the Stan file used internally for Bayesican calibration.
If no path is given, a character vector of the Stan code is returned. If
given, the code will be save to the path and the file path is returned.</p>
<p><strong>Arguments</strong></p><ul>
<li><p><code>file</code>: The path to the Stan program to use. If <code>NULL</code>, the pre-compiled
Stan code from Chong (2018) will be used. Default: <code>NULL</code>.</p></li>
<li><p><code>data</code>: Only applicable when <code>file</code> is not <code>NULL</code>. The data to be used for
Bayesican calibration. If <code>NULL</code>, the data that <code>$data_bc()</code> returns is
used. Default: <code>NULL</code>.</p></li>
<li><p><code>path</code>: A path to save the Stan code. If <code>NULL</code>, a character vector of the
Stan code is returned.</p></li>
<li><p><code>iter</code>: A positive integer specifying the number of iterations for each
chain (including warmup). Default: <code>2000</code>.</p></li>
<li><p><code>chains</code>: A positive integer specifying the number of Markov chains.
Default: <code>4</code>.</p></li>
<li><p><code>echo</code>: Whether to print intermediate output from Stan on the console,
which might be helpful for model debugging. Default: <code>TRUE</code>.</p></li>
<li><p><code>mc.cores</code>: An integer specifying how many cores to be used for Stan.
Default: <code><a href='https://rdrr.io/r/parallel/detectCores.html'>parallel::detectCores()</a></code>.</p></li>
<li><p><code>...</code>: Additional arguments to pass to <a href='https://rdrr.io/pkg/rstan/man/stanmodel-method-sampling.html'>rstan::sampling</a> (when <code>file</code> is
<code>NULL</code>) or <a href='https://rdrr.io/pkg/rstan/man/stan.html'>rstan::stan</a> (when <code>file</code> is not <code>NULL</code>).</p></li>
</ul>

    <h2 class="hasAnchor" id="inherited-methods-from-parametricjob"><a class="anchor" href="#inherited-methods-from-parametricjob"></a>Inherited Methods from <code>ParametricJob</code></h2>

    
<pre>bc$eplus_kill()
bc$eplus_status()
bc$eplus_output_dir(which = NULL)
bc$eplus_locate_output(which = NULL, suffix = ".err", strict = TRUE)
bc$eplus_errors(which = NULL, info = FALSE)
bc$eplus_report_data_dict(which = NULL)
bc$eplus_report_data(which = NULL, key_value = NULL, name = NULL,
                     year = NULL, tz = "UTC", all = FALSE, wide = FALSE,
                     period = NULL, month = NULL, day = NULL, hour = NULL, minute = NULL,
                     interval = NULL, simulation_days = NULL, day_type = NULL,
                     environment_name = NULL)
bc$eplus_tabular_data(which = NULL, report_name = NULL, report_for = NULL,
                      table_name = NULL, column_name = NULL, row_name = NULL)
bc$eplus_save(dir = NULL, separate = TRUE, copy_external = FALSE)
</pre>

<p>All methods listed above are inherited from eplusr's
<code><a href='https://hongyuanjia.github.io/eplusr/reference/ParametricJob.html'>ParametricJob</a></code>. Each method has been renamed with a
prefix <code>eplus_</code>, e.g. <code>$output_dir()</code> in <a href='https://hongyuanjia.github.io/eplusr/reference/ParametricJob.html'>eplusr::ParametricJob</a> becomes
<code>$eplus_output_dir()</code>. For detailed documentation on each
method, please see <a href='https://hongyuanjia.github.io/eplusr/reference/ParametricJob.html'>eplusr's documentation</a>.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>A. Chong and K. Menberg, "Guidelines for the Bayesian calibration of building
energy models", Energy and Buildings, vol. 174, pp. 527–547. DOI:
10.1016/j.enbuild.2018.06.028</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='kw'>if</span> (<span class='kw pkg'>eplusr</span><span class='kw ns'>::</span><span class='fu'><a href='https://hongyuanjia.github.io/eplusr/reference/use_eplus.html'>is_avail_eplus</a></span>(<span class='fl'>8.8</span>)) {
    <span class='no'>idf_name</span> <span class='kw'>&lt;-</span> <span class='st'>"5Zone_Transformer.idf"</span>
    <span class='no'>epw_name</span> <span class='kw'>&lt;-</span>  <span class='st'>"USA_CA_San.Francisco.Intl.AP.724940_TMY3.epw"</span>

    <span class='no'>idf_path</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='kw pkg'>eplusr</span><span class='kw ns'>::</span><span class='fu'><a href='https://hongyuanjia.github.io/eplusr/reference/use_eplus.html'>eplus_config</a></span>(<span class='fl'>8.8</span>)$<span class='no'>dir</span>, <span class='st'>"ExampleFiles"</span>, <span class='no'>idf_name</span>)
    <span class='no'>epw_path</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='kw pkg'>eplusr</span><span class='kw ns'>::</span><span class='fu'><a href='https://hongyuanjia.github.io/eplusr/reference/use_eplus.html'>eplus_config</a></span>(<span class='fl'>8.8</span>)$<span class='no'>dir</span>, <span class='st'>"WeatherData"</span>, <span class='no'>epw_name</span>)

    <span class='co'># create from local files</span>
    <span class='fu'>bayes_job</span>(<span class='no'>idf_path</span>, <span class='no'>epw_path</span>)

    <span class='co'># create from an Idf and an Epw object</span>
    <span class='no'>bc</span> <span class='kw'>&lt;-</span> <span class='fu'>bayes_job</span>(<span class='fu'>read_idf</span>(<span class='no'>idf_path</span>), <span class='fu'>read_epw</span>(<span class='no'>epw_path</span>))

    <span class='co'># get the seed model</span>
    <span class='no'>bc</span>$<span class='fu'>seed</span>()

    <span class='co'># get the weather</span>
    <span class='no'>bc</span>$<span class='fu'>weather</span>()

    <span class='co'># read rdd</span>
    <span class='no'>bc</span>$<span class='fu'>read_rdd</span>()

    <span class='co'># read mdd</span>
    <span class='no'>bc</span>$<span class='fu'>read_mdd</span>()

    <span class='co'># set input and output parameters</span>
    <span class='no'>bc</span>$<span class='fu'>input</span>(<span class='kw'>name</span> <span class='kw'>=</span> <span class='st'>"fan air mass flow rate"</span>, <span class='kw'>reporting_frequency</span> <span class='kw'>=</span> <span class='st'>"hourly"</span>)
    <span class='co'># set input parameters</span>
    <span class='no'>bc</span>$<span class='fu'>output</span>(<span class='kw'>name</span> <span class='kw'>=</span> <span class='st'>"fan electric power"</span>, <span class='kw'>reporting_frequency</span> <span class='kw'>=</span> <span class='st'>"hourly"</span>)

    <span class='co'># get existing input and output</span>
    <span class='no'>bc</span>$<span class='fu'>input</span>()
    <span class='no'>bc</span>$<span class='fu'>output</span>()

    <span class='co'># set sensitivity parameters using $param()</span>
    <span class='no'>bc</span>$<span class='fu'>param</span>(<span class='kw'>`Supply Fan 1`</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>Fan_Total_Efficiency</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='kw'>min</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>max</span> <span class='kw'>=</span> <span class='fl'>1.0</span>)),
        <span class='kw'>.names</span> <span class='kw'>=</span> <span class='st'>"faneff"</span>, <span class='kw'>.num_sim</span> <span class='kw'>=</span> <span class='fl'>2</span>
    )

    <span class='co'># extract samples</span>
    <span class='no'>bc</span>$<span class='fu'>samples</span>()

    <span class='co'># extract all models</span>
    <span class='no'>bc</span>$<span class='fu'>models</span>()

    <span class='co'># run parametric simulations</span>
    <span class='no'>bc</span>$<span class='fu'>eplus_run</span>(<span class='kw'>dir</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span>(), <span class='kw'>run_period</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='st'>"example"</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>31</span>))

    <span class='co'># print simulation errors</span>
    <span class='no'>bc</span>$<span class='fu'>eplus_errors</span>()

    <span class='co'># extract simulation data</span>
    <span class='no'>bc</span>$<span class='fu'>data_sim</span>()

    <span class='co'># specify field data</span>
    <span class='co'># here use the seed model as an example</span>
    <span class='co'>## clone the seed model</span>
    <span class='no'>seed</span> <span class='kw'>&lt;-</span> <span class='no'>bc</span>$<span class='fu'>seed</span>()$<span class='fu'>clone</span>()
    <span class='co'>## remove existing RunPeriod objects</span>
    <span class='no'>seed</span>$<span class='no'>RunPeriod</span> <span class='kw'>&lt;-</span> <span class='kw'>NULL</span>
    <span class='co'>## set run period as the same as in `$eplus_run()`</span>
    <span class='no'>seed</span>$<span class='fu'>add</span>(<span class='kw'>RunPeriod</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='st'>"test"</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>31</span>))
    <span class='co'>## save the model to tempdir</span>
    <span class='no'>seed</span>$<span class='fu'><a href='https://rdrr.io/r/base/save.html'>save</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempfile</a></span>(<span class='kw'>fileext</span> <span class='kw'>=</span> <span class='st'>".idf"</span>))
    <span class='no'>job</span> <span class='kw'>&lt;-</span> <span class='no'>seed</span>$<span class='fu'>run</span>(<span class='no'>epw_path</span>, <span class='kw'>echo</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
    <span class='no'>fan_power</span> <span class='kw'>&lt;-</span> <span class='no'>job</span>$<span class='fu'>report_data</span>(<span class='kw'>name</span> <span class='kw'>=</span> <span class='no'>bc</span>$<span class='fu'>output</span>()$<span class='no'>variable_name</span>, <span class='kw'>wide</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
    <span class='no'>bc</span>$<span class='fu'>data_field</span>(<span class='no'>fan_power</span>[, -<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"case"</span>, <span class='st'>"Date/Time"</span>)])

    <span class='co'># run stan</span>
    <span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='no'>bc</span>$<span class='fu'>stan_run</span>()
}
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#usage">Usage</a></li>
      <li><a href="#create">Create</a></li>
      <li><a href="#get-seed-model-and-weather">Get Seed Model and Weather</a></li>
      <li><a href="#get-rdd-amd-mdd-data-of-seed-model">Get RDD amd MDD Data of Seed Model</a></li>
      <li><a href="#set-input-and-output-parameters">Set Input and Output Parameters</a></li>
      <li><a href="#set-parameters">Set Parameters</a></li>
      <li><a href="#run-parametric-simulations">Run Parametric Simulations</a></li>
      <li><a href="#collect-simulation-data">Collect Simulation Data</a></li>
      <li><a href="#specify-measured-data">Specify Measured Data</a></li>
      <li><a href="#run-bayesian-calibration-using-stan">Run Bayesian Calibration Using Stan</a></li>
      <li><a href="#inherited-methods-from-parametricjob">Inherited Methods from <code>ParametricJob</code></a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Hongyuan Jia, Adrian Chong</p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Hongyuan Jia, Adrian Chong.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


